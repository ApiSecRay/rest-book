<?xml version="1.0" encoding="UTF-8"?>
<!-- 
##
## Sample RADL file for RESTBucks.
##
## Copyright ï¿½ EMC Corporation. All rights reserved.
##
-->
<service name="RESTBucks" xmlns="urn:radl:service" xmlns:radl="urn:radl:service" 
    xmlns:html="http://www.w3.org/1999/xhtml">
  <documentation>
    This example service follows <html:a href="http://www.infoq.com/articles/webber-rest-workflow">RESTBucks</html:a>,
    an online version of coffee shop Starbucks based on Gregor Hohpe's  
    <html:a href="http://www.enterpriseintegrationpatterns.com/ramblings/18_starbucks.html">observation</html:a>
    that it is an asynchronous processing pipeline.
  </documentation>

  <states>
    <start-state>
      <transitions>
        <transition name="Arrive" to="Arrived">
          <documentation>
            The process starts when the customer walks into the store.
          </documentation>
        </transition>
      </transitions>
    </start-state>

    <state name="Arrived" properties="home">
      <transitions>
        <transition name="Read menu" to="Deciding">
          <documentation>
            Once the customer has arrived in the store, she reads the menu to see what the store offers.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Deciding" properties="menu">
      <transitions>
        <transition name="Place order" to="Ordered" properties="order">
          <documentation>
            The customer composes an order from the items on the menu and places the order with the cashier.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Ordered" properties="order">
      <transitions>
        <transition name="Change" to="Ordered" properties="order">
          <documentation>
            As long as the customer hasn't paid, she can change her order.
          </documentation>
        </transition>
        <transition name="Cancel" to="Canceled">
          <documentation>
            The customer may decide she doesn't want anything after all and cancel the whole order.
          </documentation>
        </transition>
        <transition name="Pay" to="Paid" properties="payment">
          <documentation>
            The customer pays for the order.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Canceled" properties="order"/>

    <state name="Paid" properties="receipt">
      <transitions>
        <transition name="Take receipt" to="Waiting">
          <documentation>
            The customer accepts the confirmation of her payment.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Waiting" properties="serving">
      <transitions>
        <transition name="Wait" to="Waiting">
          <documentation>
            The customer has to wait a while.
          </documentation>
        </transition>
        <transition name="Receive notification" to="Served">
          <documentation>
            The barista notifies the customer once he has prepared her serving.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Served" properties="serving">
      <transitions>
        <transition name="Take serving" to="Happy">
          <documentation>
            The customer picks up her serving.
          </documentation>
        </transition>
      </transitions>
    </state>

    <state name="Happy"/>
  </states>

  <link-relations>
    <link-relation name="self">
      <specification href="http://tools.ietf.org/html/rfc4287"/>
      <transitions>
        <transition name="Receive notification"/>
      </transitions>
    </link-relation>
  
    <link-relation name="edit">
      <specification href="http://tools.ietf.org/html/rfc5023"/>
      <transitions>
        <transition name="Change order"/>
        <transition name="Cancel"/>
        <transition name="Take serving"/>
      </transitions>
    </link-relation>
  
    <link-relation name="payment">
      <specification href="http://tools.ietf.org/html/rfc5988"/>
      <transitions>
        <transition name="Pay"/>
      </transitions>
    </link-relation>
  
    <link-relation name="http://schema.org/menu">
      <specification href="http://schema.org/menu"/>
      <transitions>
        <transition name="Read menu"/>
      </transitions>
    </link-relation>
  
    <link-relation name="http://schema.org/OrderAction">
      <specification href="http://schema.org/OrderAction"/>
      <transitions>
        <transition name="Place order"/>
      </transitions>
    </link-relation>
  
    <link-relation name="http://schema.org/Order">
      <specification href="http://schema.org/Order"/>
      <transitions>
        <transition name="Take receipt"/>
      </transitions>
    </link-relation>
  
  </link-relations>

  <properties>
    <properties name="home" uri="http://schema.org/CafeOrCoffeeShop"/>
    
    <properties name="items">
      <properties>
        <property name="item" uri="http://schema.org/Product">
          <properties>
            <property name="name" uri="http://schema.org/name"/>
            <property name="size" uri="http://schema.org/height"/>
            <property name="milk" uri="http://www.productontology.org/doc/Milk"/>
            <property name="price" uri="http://schema.org/price"/>
            <property name="currency" uri="http://schema.org/priceCurrency"/>
          </properties>
        </property>
      </properties>
    </properties>       
  
    <properties name="menu" uri="http://schema.org/menu">
      <properties>
        <property name="items">
          <properties ref="items"/>
        </property>
      </properties>
    </properties>       
  
    <properties name="order" uri="http://schema.org/Order">
      <properties>
        <property name="items">
          <properties ref="items"/>
        </property>
        <property name="customer" uri="http://schema.org/customer"/>
        <property name="total" uri="http://schema.org/totalPrice"/>
        <property name="currency" uri="http://schema.org/priceCurrency"/>
      </properties>
    </properties>       
  
    <properties name="payment"
        uri="http://reference.data.gov.uk/def/payment#payment">
      <properties>
        <property name="amount" uri="http://schema.org/totalPrice"/>
        <property name="currency" uri="http://schema.org/priceCurrency"/>
        <property name="paymentMethod"
            uri="http://schema.org/acceptedPaymentMethod"/>
        <property name="cardholderName"
            uri="https://w3id.org/creditcard/v1/name"/>
        <property name="cardNumber"
            uri="https://w3id.org/creditcard/v1/number"/>
        <property name="expiryMotnh"
            uri="https://w3id.org/creditcard/v1/expiryMonth"/>
        <property name="expiryYear"
            uri="https://w3id.org/creditcard/v1/expiryYear"/>
        <property name="cardSecurityCode"
            uri="https://w3id.org/creditcard/v1/verificationCode"/>
      </properties>
    </properties>       
  
    <properties name="receipt" uri="http://schema.org/Order">
      <properties>
        <property name="dateTime" uri="http://schema.org/orderDate"/>
        <property name="shop" uri="http://schema.org/seller"/>
        <property name="items">
          <properties ref="items"/>
        </property>
        <property name="total" uri="http://schema.org/totalPrice"/>
        <property name="currency" uri="http://schema.org/priceCurrency"/>
        <property name="paymentMethod"
            uri="http://schema.org/acceptedPaymentMethod"/>
      </properties>
    </properties>       
    
    <properties name="serving" uri="http://schema.org/Order"/>
  </properties>

  <media-types>
    <media-type name="application/ld+json">
      <specification href="http://www.w3.org/TR/json-ld/"/>
    </media-type>
  </media-types>

  <resources>
    <resource name="Home">
      <location uri="/"/>
      <methods>
        <method name="GET">
          <transitions>
            <transition ref="Arrive"/>
          </transitions>
          <response/>
        </method>
      </methods>
    </resource>
    
    <resource name="Menu">
      <location uri="/menu/"/>
      <methods>
        <method name="GET">
          <transitions>
            <transition ref="Read menu"/>
          </transitions>
          <response/>
        </method>
      </methods>
    </resource>
    
    <resource name="Orders">
      <location uri="/orders/"/>
      <methods>
        <method name="POST">
          <transitions>
            <transition ref="Place order"/>
          </transitions>
          <request/>
          <response/>
        </method>
      </methods>
    </resource>
    
    <resource name="Order">
      <location uri-template="/orders/{order-id}/"/>
      <methods>
        <method name="DELETE">
          <transitions>
            <transition ref="Cancel"/>
          </transitions>
        </method>
        <method name="PUT">
          <transitions>
            <transition ref="Change"/>
          </transitions>
          <request/>
          <response/>
        </method>
        <method name="GET">
          <transitions>
            <transition ref="Take receipt"/>
          </transitions>
          <response/>
        </method>
      </methods>
    </resource>
    
    <resource name="Payments">
      <location uri-template="/orders/{order-id}/payments/"/>
      <methods>
        <method name="POST">
          <transitions>
            <transition ref="Pay"/>
          </transitions>
          <request/>
          <response/>
        </method>
      </methods>
    </resource>
    
    <resource name="Serving">
      <location uri-template="/orders/{order-id}/serving/"/>
      <methods>
        <method name="GET">
          <transitions>
            <transition ref="Wait"/>
            <transition ref="Receive notification"/>
          </transitions>
          <response/>
        </method>
        <method name="DELETE">
          <transitions>
            <transition ref="Take serving"/>
          </transitions>
        </method>
      </methods>
    </resource>
  </resources>
</service>
